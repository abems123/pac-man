version: 2.1

jobs:
  build_logic_only:
    docker:
      - image: cimg/base:24.04
    steps:
      - checkout

      - run:
          name: Install dependencies (logic only)
          command: |
            sudo apt-get update
            sudo apt-get install -y \
              build-essential \
              cmake \
              gcc-13 \
              g++-13

      - run:
          name: Configure (logic only) — GCC 13 + C++20
          command: |
            cmake -S logic -B build_logic \
              -DCMAKE_BUILD_TYPE=Release \
              -DCMAKE_C_COMPILER=gcc-13 \
              -DCMAKE_CXX_COMPILER=g++-13 \
              -DCMAKE_CXX_STANDARD=20 \
              -DCMAKE_CXX_STANDARD_REQUIRED=ON

      - run:
          name: Build (logic only)
          command: |
            cmake --build build_logic --parallel

  build_full_project:
    docker:
      - image: cimg/base:24.04
    steps:
      - checkout

      - run:
          name: Install dependencies (full project)
          command: |
            sudo apt-get update
            sudo apt-get install -y \
              build-essential \
              cmake \
              gcc-13 \
              g++-13 \
              libsfml-dev

      - run:
          name: Configure (full project) — GCC 13 + C++20
          command: |
            cmake -S . -B build_full \
              -DCMAKE_BUILD_TYPE=Release \
              -DCMAKE_C_COMPILER=gcc-13 \
              -DCMAKE_CXX_COMPILER=g++-13 \
              -DCMAKE_CXX_STANDARD=20 \
              -DCMAKE_CXX_STANDARD_REQUIRED=ON

      - run:
          name: Build (full project)
          command: |
            cmake --build build_full --parallel

workflows:
  build_logic_then_full:
    jobs:
      - build_logic_only
      - build_full_project:
          requires:
            - build_logic_only
